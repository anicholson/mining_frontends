#!/usr/bin/env ruby
# encoding: utf-8
# rubocop:disable AndOr

$LOAD_PATH.unshift File.expand_path('../../lib', __FILE__)

require 'bundler/setup'
require 'curses'
require 'mining_depot'
require 'pry'
require 'helpers'

include Curses

world, height, width = init_world!

start_color
init_screen

EMPTY = COLOR_WHITE
init_pair(COLOR_BLUE, COLOR_BLUE, COLOR_BLACK)
init_pair(EMPTY, EMPTY, COLOR_BLACK)

win = world_window(height, width)

begin
  noecho
  crmode
  loop do
    (0...width).each do |x|
      (0...height).each do |y|
        char, c = map_char(world[x, y].building)
        win.setpos(y + 1, x + 1)
        if c
          win.attron(color_pair(COLOR_BLUE) | A_NORMAL) { win.addstr(char) }
        else
          win.attron(color_pair(EMPTY)      | A_NORMAL) { win.addstr(char) }
        end
      end
    end

    win.refresh
    sleep 1
  end
ensure
  close_screen
end
